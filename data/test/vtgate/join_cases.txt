# Single table sharded scatter
"select * from user"
{
  "Select": "select  from user",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# Single table unsharded
"select * from main1"
{
  "Select": "select  from main1",
  "Order": 1,
  "Route": {
    "PlanID": "SelectUnsharded",
    "Keyspace": {
      "Name": "main",
      "Sharded": false
    }
  }
}

# Multi-table unsharded
"select * from main1 as m1 join main1 as m2"
{
  "Select": "select  from main1 as m1 join main1 as m2",
  "Order": 1,
  "Route": {
    "PlanID": "SelectUnsharded",
    "Keyspace": {
      "Name": "main",
      "Sharded": false
    }
  }
}

# Multi-table, multi-chunk
"select * from user join music"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select  from music",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {}
}

# Sharded & Unsharded join
"select * from user join main1"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select  from main1",
    "Order": 2,
    "Route": {
      "PlanID": "SelectUnsharded",
      "Keyspace": {
        "Name": "main",
        "Sharded": false
      }
    }
  },
  "Join": {}
}

# Left join, single chunk
"select * from main1 as m1 left join main1 as m2 on m1.a=m2.b"
{
  "Select": "select  from main1 as m1 left join main1 as m2 on m1.a = m2.b",
  "Order": 1,
  "Route": {
    "PlanID": "SelectUnsharded",
    "Keyspace": {
      "Name": "main",
      "Sharded": false
    }
  }
}

# Left join , multi-chunk
"select * from user left join main1 on a = b"
{
  "IsLeft": true,
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "IsRHS": true,
    "Select": "select  from main1 where a = b",
    "Order": 2,
    "Route": {
      "PlanID": "SelectUnsharded",
      "Keyspace": {
        "Name": "main",
        "Sharded": false
      }
    }
  },
  "Join": {}
}

# Straight-join
"select * from main1 as m1 straight_join main1 as m2"
{
  "Select": "select  from main1 as m1 straight_join main1 as m2",
  "Order": 1,
  "Route": {
    "PlanID": "SelectUnsharded",
    "Keyspace": {
      "Name": "main",
      "Sharded": false
    }
  }
}

# Parenthesized, single chunk
"select * from user join (main1 as m1 join main1 as m2)"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select  from (main1 as m1 join main1 as m2)",
    "Order": 2,
    "Route": {
      "PlanID": "SelectUnsharded",
      "Keyspace": {
        "Name": "main",
        "Sharded": false
      }
    }
  },
  "Join": {}
}

# Parenthesized, multi-chunk
"select * from user join (user as u1 join main1)"
{
  "LeftOrder": 1,
  "RightOrder": 3,
  "Left": {
    "Select": "select  from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "LeftOrder": 2,
    "RightOrder": 3,
    "Left": {
      "Select": "select  from user as u1",
      "Order": 2,
      "Route": {
        "PlanID": "SelectScatter",
        "Keyspace": {
          "Name": "user",
          "Sharded": true
        }
      }
    },
    "Right": {
      "Select": "select  from main1",
      "Order": 3,
      "Route": {
        "PlanID": "SelectUnsharded",
        "Keyspace": {
          "Name": "main",
          "Sharded": false
        }
      }
    },
		"Join": {}
  },
  "Join": {}
}

# index hints, make sure they're not stripped.
"select * from user use index(a)"
{
  "Select": "select  from user use index (a)",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# mergeable sharded join on unique vindex
"select * from user join user_extra on user.id = user_extra.user_id"
{
  "Select": "select  from user join user_extra on user.id = user_extra.user_id",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# mergeable sharded join on unique vindex, swapped operands
"select * from user join user_extra on user_extra.user_id = user.id"
{
  "Select": "select  from user join user_extra on user_extra.user_id = user.id",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# mergeable sharded join on unique vindex, and condition
"select * from user join user_extra on user.id = 5 and user.id = user_extra.user_id"
{
  "Select": "select  from user join user_extra on user.id = 5 and user.id = user_extra.user_id",
  "Order": 1,
  "Route": {
    "PlanID": "SelectEqualUnique",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    },
    "Vindex": "user_index",
    "Values": "5"
  }
}

# sharded join on unique vindex, inequality
"select * from user join user_extra on user.id < user_extra.user_id"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select  from user_extra where user.id \u003c user_extra.user_id",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {}
}

# sharded join, non-col reference RHS
"select * from user join user_extra on user.id = 5"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user where user.id = 5",
    "Order": 1,
    "Route": {
      "PlanID": "SelectEqualUnique",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      },
      "Vindex": "user_index",
      "Values": "5"
    }
  },
  "Right": {
    "Select": "select  from user_extra",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {}
}

# sharded join, non-col reference LHS
"select * from user join user_extra on 5 = user.id"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user where 5 = user.id",
    "Order": 1,
    "Route": {
      "PlanID": "SelectEqualUnique",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      },
      "Vindex": "user_index",
      "Values": "5"
    }
  },
  "Right": {
    "Select": "select  from user_extra",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {}
}

# sharded join, non-vindex col
"select * from user join user_extra on user.id = user_extra.col"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select  from user_extra where user.id = user_extra.col",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {}
}

# sharded join, non-unique vindex
"select * from user_extra join user on user_extra.user_id = user.name"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select  from user_extra",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select  from user where user_extra.user_id = user.name",
    "Order": 2,
    "Route": {
      "PlanID": "SelectEqual",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      },
      "Vindex": "name_user_map",
      "Values": "user_extra.user_id"
    }
  },
  "Join": {}
}
