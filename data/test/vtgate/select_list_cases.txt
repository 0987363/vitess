# No column referenced
"select 1 from user"
{
  "Select": "select 1 from user",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Query": "select 1 from user",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# RHS route referenced
"select user_extra.id from user join user_extra"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select 1 from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select 1 from user",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select user_extra.id from user_extra",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user_extra.id from user_extra",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {
    "RightCols": [
      0
    ]
  }
}

# Both routes referenced
"select user.col, user_extra.id from user join user_extra"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select user.col from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user.col from user",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select user_extra.id from user_extra",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user_extra.id from user_extra",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {
    "LeftCols": [
      0
    ],
    "RightCols": [
      1
    ]
  }
}

# Expression with single-route reference
"select user.col, user_extra.id + user_extra.col from user join user_extra"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select user.col from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user.col from user",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select user_extra.id + user_extra.col from user_extra",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user_extra.id + user_extra.col from user_extra",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {
    "LeftCols": [
      0
    ],
    "RightCols": [
      1
    ]
  }
}

# Jumbled references
"select user.col, user_extra.id, user.col2 from user join user_extra"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select user.col, user.col2 from user",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user.col, user.col2 from user",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select user_extra.id from user_extra",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user_extra.id from user_extra",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {
    "LeftCols": [
      0,
      2
    ],
    "RightCols": [
      1
    ]
  }
}

# Aggregate on unsharded
"select count(*), col from main1"
{
  "Select": "select count(*), col from main1",
  "Order": 1,
  "Route": {
    "PlanID": "SelectUnsharded",
    "Query": "select count(*), col from main1",
    "Keyspace": {
      "Name": "main",
      "Sharded": false
    }
  }
}

# Aggregate on unique sharded
"select count(*), col from user where id = 1"
{
  "Select": "select count(*), col from user where id = 1",
  "Order": 1,
  "Route": {
    "PlanID": "SelectEqualUnique",
    "Query": "select count(*), col from user where id = 1",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    },
    "Vindex": "user_index",
    "Values": "1"
  }
}

# Aggregate on sharded with colvindex
"select count(*), id from user"
{
  "Select": "select count(*), id from user",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Query": "select count(*), id from user",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# Non-aggregate function on sharded with no colvindex
"select fun(1), col from user"
{
  "Select": "select fun(1), col from user",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Query": "select fun(1), col from user",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# Distinct
"select distinct col, id from user"
{
  "Select": "select distinct col, id from user",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Query": "select distinct col, id from user",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# Group by unsharded
"select col1, col2 from main1 group by col2"
{
  "Select": "select col1, col2 from main1 group by col2",
  "Order": 1,
  "Route": {
    "PlanID": "SelectUnsharded",
    "Query": "select col1, col2 from main1 group by col2",
    "Keyspace": {
      "Name": "main",
      "Sharded": false
    }
  }
}

# Group by on unique sharded
"select col1, col2 from user where id = 1 group by col2"
{
  "Select": "select col1, col2 from user where id = 1 group by col2",
  "Order": 1,
  "Route": {
    "PlanID": "SelectEqualUnique",
    "Query": "select col1, col2 from user where id = 1 group by col2",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    },
    "Vindex": "user_index",
    "Values": "1"
  }
}

# Group by on unique vindex
"select col1, id from user group by id"
{
  "Select": "select col1, id from user group by id",
  "Order": 1,
  "Route": {
    "PlanID": "SelectScatter",
    "Query": "select col1, id from user group by id",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    }
  }
}

# HAVING multi-route
"select user.col1 as a, user.col2, user_extra.col3 from user join user_extra having 1 = 1 and a = 1 and a = user.col2 and user_extra.col3 = 1"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select user.col1 as a, user.col2 from user having 1 = 1 and a = 1 and a = user.col2",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user.col1 as a, user.col2 from user having 1 = 1 and a = 1 and a = user.col2",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select user_extra.col3 from user_extra having user_extra.col3 = 1",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user_extra.col3 from user_extra having user_extra.col3 = 1",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {
    "LeftCols": [
      0,
      1
    ],
    "RightCols": [
      2
    ]
  }
}

# ORDER BY
"select user.col1 as a, user.col2, user_extra.col3 from user join user_extra order by a asc, user.col2 desc, user_extra.col3 asc"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select user.col1 as a, user.col2 from user order by a asc, user.col2 desc",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user.col1 as a, user.col2 from user order by a asc, user.col2 desc",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Right": {
    "Select": "select user_extra.col3 from user_extra order by user_extra.col3 asc",
    "Order": 2,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user_extra.col3 from user_extra order by user_extra.col3 asc",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      }
    }
  },
  "Join": {
    "LeftCols": [
      0,
      1
    ],
    "RightCols": [
      2
    ]
  }
}

# LIMIT
"select col1 from user where id = 1 limit 1"
{
  "Select": "select col1 from user where id = 1 limit 1",
  "Order": 1,
  "Route": {
    "PlanID": "SelectEqualUnique",
    "Query": "select col1 from user where id = 1 limit 1",
    "Keyspace": {
      "Name": "user",
      "Sharded": true
    },
    "Vindex": "user_index",
    "Values": "1"
  }
}

# subquery
"select u.m from user_extra join user u where u.id in (select m2 from user where user.id = u.id and user_extra.col = user.col) and u.id in (user_extra.col, 1)"
{
  "LeftOrder": 1,
  "RightOrder": 2,
  "Left": {
    "Select": "select user_extra.col from user_extra",
    "Order": 1,
    "Route": {
      "PlanID": "SelectScatter",
      "Query": "select user_extra.col from user_extra",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      },
      "SupplyVars": {
        "col": 0
      }
    }
  },
  "Right": {
    "Select": "select u.m from user as u where u.id in (select m2 from user where user.id = u.id and user.col = user_extra.col) and u.id in ::_vals",
    "Order": 2,
    "Route": {
      "PlanID": "SelectIN",
      "Query": "select u.m from user as u where u.id in (select m2 from user where user.id = u.id and user.col = :col) and u.id in ::_vals",
      "Keyspace": {
        "Name": "user",
        "Sharded": true
      },
      "Vindex": "user_index",
      "Values": "[:col 1]",
      "UseVars": {
        "col": {}
      }
    }
  },
  "Join": {
    "RightCols": [
      0
    ]
  }
}
