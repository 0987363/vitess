install:
  dependencies:
    - automake
    - bison
    - bzip2
    - chromium
    - curl
    - g++
    - git
    - libgconf-2-4
    - libssl-dev
    - libtool
    - make
    - mercurial
    - openjdk-7-jdk
    - php-pear
    - php5-cli
    - php5-dev
    - pkg-config
    - python-crypto
    - python-dev
    - python-mysqldb
    - ruby
    - ruby-dev
    - software-properties-common
    - virtualenv
    - unzip
    - xvfb
  extra:
    - apt-key adv --recv-keys --keyserver keyserver.ubuntu.com 0xcbcb082a1bb943db
    - add-apt-repository 'deb [arch=amd64,i386,ppc64el] http://sfo1.mirrors.digitalocean.com/mariadb/repo/10.1/debian jessie main'
    - apt-get update
    - apt-get install -y libmariadbclient-dev
    - wget https://storage.googleapis.com/golang/go1.7.4.linux-amd64.tar.gz
    - tar -C /usr/local -xzf go1.7.4.linux-amd64.tar.gz
    - wget https://storage.googleapis.com/kubernetes-helm/helm-v2.1.3-linux-amd64.tar.gz
    - tar -zxvf helm-v2.1.3-linux-amd64.tar.gz
    - pip install numpy
    - pip install mysql-python
    - debconf-set-selections <<< 'mariadb-server-10.1 mysql-server/root_password password root'
    - debconf-set-selections <<< 'mariadb-server-10.1 mysql-server/root_password_again password root'
    - apt-get install -y mariadb-server
    - mysqld &
  path:
    - /usr/local/go/bin
    - /app/linux-amd64/
  cluster_setup:
    - type: gke
      project_name: e-sunlight-726
      keyfile: /config/keyfile.json
config:
  - docker_image: vitess/root
    github:
      repo: youtube/vitess
      repo_prefix: src/github.com/youtube/vitess
    environment:
      sandbox: test/cluster/sandbox/vitess_kubernetes_sandbox.py
      config: test/cluster/sandbox/example_sandbox.yaml
      cluster_type: gke
      application_type: k8s
    before_test:
      - ./bootstrap.sh
      - if [[ $? -gt 0 ]]; then ./bootstrap.sh; fi
      - source ./dev.env
      - go get github.com/youtube/vitess/go/cmd/vtctlclient
    tests:
      - file: test/cluster/drain_test.py
        params:
          num_drains: 1
      - file: test/cluster/backup_test.py
        params:
          num_backups: 1
      - file: test/cluster/reparent_test.py
        params:
          num_reparents: 1
